/*! ChatToy created by KoikDaisy at https://github.com/KoikDaisyGit/ChatToy */
var ClipData,Activity=function(){function i(e,t){this.dialogues=[],this.name="",this.textColor="",this.backgroundColor="",this.botPfp="",this.backgroundURL="",this.name=e,this.dialogues=t}return Object.defineProperty(i,"Current",{get:function(){return i.current},enumerable:!1,configurable:!0}),i.SetCurrent=function(e){e&&((this.current=e).textColor||(e.textColor="black"),e.backgroundColor||(e.backgroundColor="#d9d9d9"),this.SetColors(e.textColor,e.backgroundColor),e.backgroundURL&&""!=e.backgroundURL?$(":root")[0].style.setProperty("--url-background","url(".concat(null==(e=Files.GetFile(e.backgroundURL))?void 0:e.url,")")):($(":root")[0].style.setProperty("--url-background","none"),$(":root")[0].style.setProperty("--bg-filter","none")))},i.SetColors=function(e,t){$(":root")[0].style.setProperty("--color-action-text",e),$(":root")[0].style.setProperty("--color-background",t)},i.SetCurrentFromName=function(e){for(var t=!1,n=0;n<Data.Activities.length;n++){var o=Data.Activities[n];if(o.name.toLowerCase()==(null==e?void 0:e.toLowerCase())){i.SetCurrent(o),t=!0;break}}return t},i}(),Chat=function(){function c(){}return Object.defineProperty(c,"MessageHistory",{get:function(){return this.messageHistory},enumerable:!1,configurable:!0}),c.SendString=function(e,t,n,o,i,r,a){r=t==ContentType.Action||o.Contains("*")&&t!=ContentType.Image?ActionMessage(e,o.ReplaceAll("*",""),r,a):e==SenderType.User?UserChatMessage(t,o,r,a):BotChatMessage(t,n,o,r,i,a);for(this.chatList.appendChild(r),window.scrollTo(0,999999),setTimeout(function(){window.scrollTo(0,999999)},50),this.messageHistory.push({senderType:e,contentType:t,string:o,emoji:i,pfp:n});100<this.chatList.children.length;)this.chatList.removeChild(this.chatList.firstElementChild);for(;100<this.messageHistory.length;)this.messageHistory.shift();Data.Save()},c.SendMessage=function(t,n,o){var e,i=this.GetUnusedString(t),r=t.senderType==SenderType.User?Data.userPfp:Activity.Current.botPfp,i=this.ProcessString(i,t.senderType,t.contentType),a=this.ResolveRandoms(null==(e=t.emoji)?void 0:e.PickOne()),s=this.SplitActions(i),l=1;c.SendString(t.senderType,t.contentType,r,s[0],a,function e(){setTimeout(function(){l<s.length?c.SendString(t.senderType,t.contentType,r,s[l],a,function(){l++,e()},o):n&&n()},1e3)},o),Data.previousMessageDate=Date.now()},c.SetSuggestions=function(e){var n=this,o=[],i=(this.suggestionList.ClearChildren(),this.currentSuggestions=[],0);e.forEach(function(t){var e=0==o.length||o.every(function(e){return e!=t.title});i<3&&e&&(i++,o.push(t.title),e=MessageSuggestion(t),n.suggestionList.prepend(e),n.currentSuggestions.push(t))})},c.PlayDialogue=function(e){var o;function i(e){var t=e.exchanges.PickOne();return 1<e.exchanges.length&&c.previousExchange==t&&(c.usedStringsCache=[],t=e.exchanges.filter(function(e){return c.previousExchange!=e}).PickOne()),c.previousExchange=t}3<this.dialogueQueue.length||!this.enabled||(this.previousDialogue=e,this.dialogueQueue.push(e),NewBar.Remove(),mainInput.value="",this.SetSuggestions([]),1<this.dialogueQueue.length)||(o=i(e),this.SendMessage(e.userMessage,function(){var n=0;!function t(){setTimeout(function(){var e;n<(null==o?void 0:o.messages.length)?(o.switchToActivity&&Activity.SetCurrentFromName(o.switchToActivity),c.SendMessage(o.messages[n],function(){n++,t()})):(c.dialogueQueue.shift(),0<(null==(e=null==o?void 0:o.dialoguePaths)?void 0:e.length)?(c.SetSuggestions(o.dialoguePaths),c.dialogueQueue=[]):0<c.dialogueQueue.length&&(o=i(c.dialogueQueue[0]),c.SendMessage(c.dialogueQueue[0].userMessage,function(){n=0,t()})))},500*Math.random()+1e3)}()}))},c.Clear=function(){this.messageHistory=[],this.chatList.ClearChildren()},c.GetUnusedString=function(t){var n,e,o,i=t.strings.PickOne();return 1<t.strings.length&&(n=i,e=0<(null==(e=c.usedStringsCache)?void 0:e.length),o=!c.usedStringsCache.every(function(e){return e.string!=n||e.message!=t}),e&&o&&(i=t.strings.filter(function(e){return e!=i}).PickOne()),this.usedStringsCache=this.usedStringsCache.filter(function(e){return e.message!=t}),this.usedStringsCache.push({message:t,string:i})),i},c.ProcessString=function(e,t,n){return e=this.ResolveRandoms(e),e=this.AddNicknames(e,t,n),e=this.AddPronouns(e,n)},c.AddNicknames=function(e,t,n){function o(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(".?!".Contains(o)){e=e.replace(o,", ".concat((null==t?void 0:t.PickOne())+o));break}}return e}return e=Data.nicknamesEnabled&&n==ContentType.Speech&&.75<Math.random()?t==SenderType.User?o(e,Data.botNicknames):o(e,Data.userNicknames):e},c.AddPronouns=function(e,t){if(e.Contains("{")&&e.Contains("}")){if(4<this.pronounCounter&&.75<Math.random()||7<this.pronounCounter){for(var n=this.pronounCounter=0,o=0;-1<n&&-1<o;)if(-1!=(n=e.indexOf("{",o))&&-1!=(o=e.indexOf("}",n))){var i=!1;switch(e.substring(n,o)){case"{sub":e=e.replace("{sub}",Data.botName),i=!0;break;case"{pos":e=e.replace("{pos}","s"==Data.botName.toLowerCase().LastChar()?"".concat(Data.botName,"'"):"".concat(Data.botName,"'s")),i=!0;break;case"{obj":e=e.replace("{obj}",Data.botName),i=!0}if(i)break}}else this.pronounCounter++;e=this.ReplacePronoun(e,"{sub}",Data.pronouns.sub),e=this.ReplacePronoun(e,"{obj}",Data.pronouns.obj),e=this.ReplacePronoun(e,"{pos}",Data.pronouns.pos)}else this.pronounCounter++;return e},c.ReplacePronoun=function(e,t,n){if(t!=n)for(;e.Contains(t);){var o=this.IsBeginningOfSentence(e,e.indexOf(t))?n.Capitalize():n.toLowerCase();e=e.replace(t,o)}return e},c.IsBeginningOfSentence=function(n,o){var i=!1;return 0==o||!(o<0)&&([".","?","!","*","{"].forEach(function(e){var t=n.lastIndexOf(e,o);n.substring(t,o).ReplaceAll(" ","").ReplaceAll("\\n","")==e&&(i=!0)}),i)},c.ResolveRandoms=function(e){if(e&&e.Contains("[")&&e.Contains("]"))for(var t,n,o=0,i=0;-1<o&&-1<i;)(o=e.lastIndexOf("["))<(i=e.indexOf("]",o))&&(n=(t=e.substring(o+1,i)).split("|").PickOne(),e=e.replace("[".concat(t,"]"),n));return e},c.SplitActions=function(e){for(var t=[];1<e.Count("*");){var n=e.indexOf("*"),o=e.indexOf("*",n+1)+1;e.substring(0,n)&&t.push(e.substring(0,n)),e.substring(n,o)&&t.push(e.substring(n,o)),e=e.substring(o,e.length)}return""==e&&0!=t.length||t.push(e),t},c.SendReturnMessage=function(){var e,t,n,o=this,i=null==(e=Data.awayMessages)?void 0:e.PickOne();i&&(mainInput.style.opacity="50%",c.enabled=!1,t=1,n=function(){setTimeout(function(){t<i.messages.length?c.SendMessage(i.messages[t],function(){t++,n()}):(0<i.dialoguePaths.length?(c.SetSuggestions(i.dialoguePaths),o.dialogueQueue=[]):o.dialogueQueue.length,mainInput.style.opacity="unset",c.enabled=!0)},1e3*Math.random()+1e3)},c.backFromLongDeparture=!0,setTimeout(function(){NewBar.Set(),Activity.SetCurrentFromName(null==i?void 0:i.switchToActivity),c.SendMessage(i.messages[0],n)},1e3*Math.random()+2e3))},c.chatList=document.getElementById("chat-main"),c.suggestionList=document.getElementById("suggestions"),c.messageHistory=[],c.currentSuggestions=[],c.backFromLongDeparture=!1,c.enabled=!0,c.dialogueQueue=[],c.usedStringsCache=[],c.pronounCounter=8,c}(),DataCompression=function(){function e(){}return e.Compress=function(t){return this.replacements.forEach(function(e){t=t.ReplaceAll(e.str,e.rpl)}),t},e.Decompress=function(t){return this.replacements.forEach(function(e){t=t.ReplaceAll(e.rpl,e.str)}),t},e.replacements=[{str:'"title":',rpl:'"t":'},{str:'"exchanges":',rpl:'"ex":'},{str:'"messages":',rpl:'"m":'},{str:'"pfp":',rpl:'"p":'},{str:'"emoji":',rpl:'"e":'},{str:'"strings":',rpl:'"s":'},{str:'"string":',rpl:'"sr":'},{str:'"contentType":',rpl:'"c":'},{str:'"userMessage":',rpl:'"u":'},{str:'"senderType":',rpl:'"sT":'},{str:'"dialogues":',rpl:'"d":'},{str:'"dialoguePaths":',rpl:'"dP":'},{str:'"backgroundURL":',rpl:'"b":'},{str:'"name":',rpl:'"n":'},{str:'"actionSuggestion":',rpl:'"a":'},{str:'"botPfp":',rpl:'"bp":'},{str:':"./img/_profile-pics/',rpl:':"p/'},{str:':"./img/_backgrounds/',rpl:':"b/'}],e}(),Data=(!function(e){e[e.Activity=0]="Activity",e[e.Dialogue=1]="Dialogue",e[e.Exchange=2]="Exchange",e[e.Message=3]="Message",e[e.String=4]="String",e[e.Strings=5]="Strings"}(ClipData=ClipData||{}),function(){function r(){}return r.LoadJSON=function(e){var t;function n(e,t){return void 0===e?t:e}if(e)try{e=DataCompression.Decompress(e);var o,i=JSON.parse(e);this.Activities=n(i.Activities,[DefaultActivity()]),this.userPfp=n(i.userPfp,this.userPfp),this.userColor=n(i.userColor,this.userColor),this.botColor=n(i.botColor,this.botColor),this.actionColor=n(i.actionColor,this.actionColor),this.botName=n(i.botName,this.botName),this.userNicknames=n(i.userNicknames,this.userNicknames),this.botNicknames=n(i.botNicknames,this.botNicknames),this.pronouns=n(i.pronouns,this.pronouns),this.nicknamesEnabled=n(i.nicknamesEnabled,this.nicknamesEnabled),this.awayMessages=n(i.awayMessages,this.awayMessages),this.awayThreshhold=n(i.awayThreshhold,this.awayThreshhold),this.previousMessageDate=n(i.previousMessageDate,this.previousMessageDate),r.UpdateColors(),Chat.Clear(),null!=(t=i.MessageHistory)&&t.forEach(function(e){Chat.SendString(e.senderType,e.contentType,e.pfp,e.string,e.emoji,null,!0)}),Activity.SetCurrentFromName(i.Acurrent)||(0==this.Activities.length&&this.Activities.push(DefaultActivity()),Activity.SetCurrent(r.Activities[0])),null!=r.previousMessageDate&&(o=Hours(Date.now()-r.previousMessageDate),r.awayThreshhold<o)&&Chat.SendReturnMessage(),setTimeout(function(){window.scrollTo(0,9999)},50)}catch(e){console.error(e)}else this.Activities=[DefaultActivity()],Activity.SetCurrent(r.Activities[0]),Chat.Clear(),Chat.SendString(SenderType.Bot,ContentType.Action,"",'Welcome. To begin, try typing "hello" in the little cloud box, and click the first option that pops up.')},r.GetData=function(o){var i,t;"indexedDB"in window?((t=indexedDB.open(this.dataKey)).onupgradeneeded=function(){r.OpenOrGetStore(t,r.dataKey),r.OpenOrGetStore(t,"Files"),Files.AddInitialFiles(),i=r.GetLocalStorage()},t.onsuccess=function(){var n=t.result.transaction(r.dataKey,"readonly"),e=n.objectStore(r.dataKey).get(r.dataKey);e.onsuccess=function(){i=e.result,console.log("IndexedDB data successfully fetched.")},e.onerror=function(){console.error(e.error),i=r.GetLocalStorage(),n.commit()},n.oncomplete=function(){var e=n.db.transaction("Files","readonly"),t=e.objectStore("Files").get("Files");t.onsuccess=function(){Array.isArray(t.result)&&t.result.forEach(function(e){Files.AddFile({file:e.file,category:e.category,url:e.url})})},e.oncomplete=function(){o(i)}}}):(console.warn("IndexedDB not found. Using LocalStorage, which has a smaller size limit."),o(this.GetLocalStorage()))},r.GetLocalStorage=function(){return localStorage.getItem(r.dataKey)},r.Load=function(){this.GetData(function(e){r.LoadJSON(e)})},r.Save=function(n){var e,o,i=JSON.stringify({MessageHistory:Chat.MessageHistory,Activities:this.Activities,Acurrent:null==(e=Activity.Current)?void 0:e.name,botName:this.botName,userPfp:this.userPfp,userColor:this.userColor,botColor:this.botColor,actionColor:this.actionColor,pronouns:this.pronouns,userNicknames:this.userNicknames,botNicknames:this.botNicknames,nicknamesEnabled:this.nicknamesEnabled,awayMessages:this.awayMessages,awayThreshhold:this.awayThreshhold,previousMessageDate:this.previousMessageDate}),i=DataCompression.Compress(i);"indexedDB"in window?((o=indexedDB.open(r.dataKey)).onupgradeneeded=function(){r.OpenOrGetStore(o,r.dataKey),r.OpenOrGetStore(o,"Files")},o.onsuccess=function(){var e=o.result;e.onerror=function(e){console.error(e.target.error)};var t=e.transaction(r.dataKey,"readwrite").objectStore(r.dataKey);r.SaveDataTransaction(t,r.dataKey,i,function(e){e.onsuccess=function(){n&&n()},e.onerror=function(){console.error(e.error),n&&n()}});t=e.transaction("Files","readwrite").objectStore("Files");r.SaveDataTransaction(t,"Files",Files.Files,function(e){e.onerror=function(){console.log(e.error)}})},o.onerror=function(e){console.error(e.target.error)}):(localStorage.setItem(this.dataKey,i),n&&n())},r.DeleteAllData=function(){var e=indexedDB.deleteDatabase(r.dataKey);e.onupgradeneeded=function(){console.log("upgrade!"),console.log(e.result),window.location.reload()},e.onsuccess=function(){console.log("success!"),console.log(e.result),window.location.reload()},e.onerror=function(){console.log("failure!"),console.error(e.error),window.location.reload()},e.onblocked=function(){window.location.reload()}},r.UpdateColors=function(){$(":root")[0].style.setProperty("--color-user",this.userColor),$(":root")[0].style.setProperty("--color-bot",this.botColor),$(":root")[0].style.setProperty("--color-action-suggestion",this.actionColor)},r.SaveDataTransaction=function(t,n,o,i){var e=t.getKey(n);e.onsuccess=function(){var e=t.put(o,n);i&&i(e)},e.onerror=function(){var e=t.add(o,n);i&&i(e)}},r.OpenOrGetStore=function(e,t){var n=e.result;return n.onerror=function(e){console.error(e.target.error)},n.objectStoreNames.contains(t)||e.transaction.objectStoreNames.contains(t)?e.transaction.objectStore(t):n.createObjectStore(t)},r.Activities=[],r.botName="Kiki",r.userPfp="",r.userColor="#0073ff",r.actionColor="#323f4e",r.botColor="#ff5e9e",r.nicknamesEnabled=!1,r.userNicknames=[],r.botNicknames=[],r.pronouns={sub:"she",obj:"her",pos:"her"},r.awayMessages=[],r.awayThreshhold=4,r.previousMessageDate=void 0,r.clipboard={type:void 0,value:void 0},r.dataKey="ChatAppV2",r}());function Hours(e){return e/1e3/60/60}var Dialogue=function(e,t,n){this.title="",this.exchanges=[],this.title=e,this.exchanges=n,this.userMessage=t},EditorManager=function(){function e(){}return e.Open=function(e){e.AppendTo(this.div)},e.div=document.getElementById("editors-container"),e}(),Editor=function(){function e(e,t){var n=this,e=(this.element=$('\n        <div class="editor editor-activity container">\n            <div class="editor-background"></div>\n            \n        </div>\n    ')[0],this.onCloseFunction=e,$('<div class="top-bar"></div>')),o=$('<button class="top-button cancel-button"></button>').on("click",function(){n.Close()});$(e).append(o),this.title=$("<h2></h2>")[0],$(e).append(this.title),t?$(e).append('<div style="width:50px;height:50px;margin-right:10px;margin-left:auto;">'):(o=$('<button class="top-button done-button"></button>').on("click",function(){n.ApplyModifications(),n.Close()}),$(e).append(o)),this.container=$('<div class="editor-container"></div>')[0],$(this.element).append(this.container),$(this.element).append(e),$(this.element).show()}return e.prototype.Close=function(){var e=this;this.onCloseFunction&&this.onCloseFunction(),$(this.element).hide({duration:100,complete:function(){e.element.remove(),Data.Save()}})},e.prototype.SetTitle=function(e){this.title.innerText=e},e.prototype.AppendTo=function(e){e.appendChild(this.element)},e.prototype.append=function(e){this.container.appendChild(e)},e.prototype.SetChild=function(e){this.container.ClearChildren(),this.container.appendChild(e)},e.prototype.NewBox=function(){var e=$('<div class="editor-box"></div>')[0];return this.append(e),e},e}(),Exchange=function(e,t,n){this.switchToActivity="",this.messages=[],this.dialoguePaths=[],this.messages=e,this.dialoguePaths=t,this.switchToActivity=n},Files=function(){function e(){}return e.AddCategory=function(t){this.categories.every(function(e){return e!=t})&&this.categories.push(t)},e.RemoveCategory=function(t){this.categories=this.categories.filter(function(e){return e!=t}),this.files=this.files.filter(function(e){return e.category!=t})},e.AddInitialFiles=function(){this.files.push({file:new File([],"Kiki.png"),category:this.ProfilePicturesCategory,url:"assets/Kiki.png"}),this.files.push({file:new File([],"bg-1.png"),category:this.BackgroundCategory,url:"assets/bg-1.png"}),this.files.push({file:new File([],"bg-2.png"),category:this.BackgroundCategory,url:"assets/bg-2.png"})},e.AddFile=function(t){t.url&&!t.url.Contains("blob")||(t.url=URL.createObjectURL(t.file)),this.files=this.files.filter(function(e){return e.file.name!=t.file.name}),this.files.push(t),this.categories.Contains(t.category)||this.categories.push(t.category)},e.RemoveFile=function(t){this.files=this.files.filter(function(e){return e.file.name!=t})},e.GetFile=function(t){var n=void 0;return this.files.forEach(function(e){e.file.name==t&&(n=e)}),n},e.GetArtCategories=function(){var t=this;return this.categories.filter(function(e){return e!=t.ProfilePicturesCategory&&e!=t.BackgroundCategory})},Object.defineProperty(e,"BackgroundCategory",{get:function(){return"Backgrounds"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ProfilePicturesCategory",{get:function(){return"ProfilePics"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Categories",{get:function(){return this.categories},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Files",{get:function(){return this.files},enumerable:!1,configurable:!0}),e.categories=[],e.files=[],e}(),ChFileList=function(){},Message=function(e,t,n,o){this.strings=[],this.emoji=[],this.strings=n,this.contentType=t,this.senderType=e,this.emoji=o};function DefaultActivity(){var e=new Activity("Default",[TutorialDialogue()]);return e.botPfp="Kiki.png",e.textColor="black",e.backgroundColor="#d9d9d9",e.backgroundURL="",e}function TutorialDialogue(){return new Dialogue("Hello",new Message(SenderType.User,ContentType.Speech,["Hello."],[]),[new Exchange([new Message(SenderType.Bot,ContentType.Speech,["Hi there! I'm Kiki."],[]),new Message(SenderType.Bot,ContentType.Speech,["Welcome to this little chat toy."],[]),new Message(SenderType.Bot,ContentType.Speech,["Are you familiar with how this works?"],[])],[new Dialogue("I'm new",new Message(SenderType.User,ContentType.Speech,["I'm pretty new."],[]),[new Exchange([new Message(SenderType.Bot,ContentType.Speech,["Oh, uh..."],["ðŸ˜®"]),new Message(SenderType.Bot,ContentType.Speech,["Well, it looks like-"],[]),new Message(SenderType.Bot,ContentType.Action,["{sub} rifles through her pages, getting noticably uncomfortable."],[]),new Message(SenderType.Bot,ContentType.Speech,["Hold on, hon. We'll get you taken care of."],[]),new Message(SenderType.Bot,ContentType.Speech,["Ah. Here are the instructions I was looking for!"],[]),new Message(SenderType.Bot,ContentType.Action,["A frown appears on {pos} face."],[]),new Message(SenderType.Bot,ContentType.Speech,["Oh. All it says here is that you should open the menu in the top right and explore around a little."],[]),new Message(SenderType.Bot,ContentType.Speech,["Hope you can manage alright! I can't really help you with anything that isn't written in the notes I took."],[])])]),new Dialogue("I don't need help",new Message(SenderType.User,ContentType.Speech,["I think I know what I'm doing."],[]),[new Exchange([new Message(SenderType.Bot,ContentType.Speech,["Oh, uh..."],["ðŸ˜®"]),new Message(SenderType.Bot,ContentType.Speech,["Okay then. I had a tutorial somwhere in here."],[]),new Message(SenderType.Bot,ContentType.Action,["She rifles through her pages, unable to find it."],[]),new Message(SenderType.Bot,ContentType.Speech,["Oh well. Hope you enjoy yourself!"],[])])])])])}function ActionMessage(e,t,n,o){var e=Create("li",e==SenderType.User?"message message-user":"message message-bot"),i=Create("p","action-text",e);return i.innerText=t,!o&&t?$(i).t({speed:25,caret:!1,fin:function(){n&&n(),i.ClearChildren(),i.innerText=t}}):n&&n(),e}function BotChatMessage(e,t,n,o,i,r){var a=Create("li","message message-bot"),t=(Create("img","pfp",a).src=null==(t=Files.GetFile(t))?void 0:t.url,SpeechBubble(SenderType.Bot,e,n,function(){i&&(Create("p","emoji",a).innerText=i),o&&o()},r));return a.appendChild(t),r&&i&&(Create("p","emoji",a).innerText=i),e==ContentType.Speech&&Create("div","bubbletail bubbletail-bot",t),a}function MessageSuggestion(t){var e=Create("li","message message-user"),n=Create("button",t.userMessage.contentType==ContentType.Speech?"speech-bubble speech-bubble-user":"speech-bubble speech-bubble-neutral",e);return n.innerText=t.title,n.addEventListener("click",function(e){mainInput.focus(),Chat.PlayDialogue(t)}),e}var NewBar=function(){function e(){}return e.Set=function(){this.Remove(),this.instance=$('<div class="new-bar"/><span>NEW</span><hr/></div>')[0],$("#chat-main").append(this.instance)},e.Remove=function(){var e;null!=(e=this.instance)&&e.remove()},e}();function SpeechBubble(e,t,n,o,i){var r,a=Create("div",e==SenderType.Bot?"speech-bubble speech-bubble-bot":"speech-bubble speech-bubble-user");return t==ContentType.Speech?((r=Create("p","",a)).innerText=n,!i&&n&&e==SenderType.Bot?$(r).t({caret:!1,speed:10,speed_vary:!0,mistype:!0,fin:function(){o&&o(),r.ClearChildren(),r.innerText=n}}):o&&o()):n&&(null!=(t=Files.GetFile(n))&&t.file.type.toLowerCase().Contains("video")?((i=Create("video","bubble-image",a)).src=null==t?void 0:t.url,i.muted=!0,i.autoplay=!0,i.loop=!0):Create("img","bubble-image",a).src=null==t?void 0:t.url,o)&&o(),a}var imagePaths=null;function UserChatMessage(e,t,n,o){var i=Create("li","message message-user"),t=SpeechBubble(SenderType.User,e,t,n,o);return i.appendChild(t),e==ContentType.Speech&&Create("div","bubbletail bubbletail-user",t),Data.userPfp&&(Create("img","pfp",i).src=Files.GetFile(Data.userPfp).url),i}var __extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),ActivityEditor=function(n){function e(e,t){t=n.call(this,t)||this;return t.model={dialogues:[],textColor:"",backgroundColor:"",backgroundURL:"",name:"",botPfp:""},t.activity=e,t.model={dialogues:$.extend(!0,[],t.activity.dialogues),textColor:t.activity.textColor,backgroundColor:t.activity.backgroundColor,backgroundURL:e.backgroundURL,name:e.name,botPfp:e.botPfp},t.RefreshDisplay(),t}return __extends(e,n),e.prototype.ApplyModifications=function(){var e;this.activity.dialogues=this.model.dialogues,this.activity.name=this.model.name,this.activity.textColor=this.model.textColor,this.activity.backgroundColor=this.model.backgroundColor,Activity.Current==this.activity&&Activity.SetCurrent(this.activity),this.activity.backgroundURL=this.model.backgroundURL,this.activity.botPfp=this.model.botPfp,this.activity.name!=(null==(e=Activity.Current)?void 0:e.name)&&Activity.Current||Activity.SetCurrent(this.activity)},e.prototype.RefreshDisplay=function(){var e,o=this,t=(this.SetTitle(this.model.name),this.NewBox());this.SetChild(t),"Default"!=this.activity.name&&(t.append($("<h3>Activity Name<h3>")[0]),e=StringCard(this.model.name,function(e){""==e.value||"Default"==e.value?(e.value="<>",o.model.name="<>"):o.model.name=e.value},null),t.append(e),t=this.NewBox()),t.append($("<h3>Dialogue Options<h3>")[0]),t.append(SearchableList(this.model.dialogues,function(e,t){var n=Create("div"),t=DialogueCard(e,function(){o.ApplyModifications(),EditorManager.Open(new DialogueEditor(e,o.RefreshDisplay.bind(o)))},MoreMenuArrayFunctions(o,o.model.dialogues,t,n,ClipData.Dialogue));return n.append(t),n},function(){return new Dialogue("",new Message(0,0,["<>"],[]),[])},function(e){return JSON.stringify(e)},[{name:"Clear",color:"red",function:function(){o.model.dialogues=[],o.RefreshDisplay()}}])),(t=this.NewBox()).append($("<h5>".concat(Data.botName,"'s Profile Picture<h5>"))[0]),t.append(ImageCard(this.model.botPfp,function(){EditorManager.Open(new ImagePicker([Files.ProfilePicturesCategory],function(e){o.model.botPfp=e,o.RefreshDisplay()}))},null)),(t=this.NewBox()).append($("<h3>Activity Background<h3>")[0]),t.append(ImageCard(this.model.backgroundURL,function(){EditorManager.Open(new ImagePicker([Files.BackgroundCategory],function(e){o.model.backgroundURL=e,o.RefreshDisplay()}))},null)),(t=this.NewBox()).append($("<h3>Colors<h3>")[0]),t.append($("<h5>Normal Text<h5>")[0]),t.append(ColorPicker(this.model.textColor,function(e){o.model.textColor=e.value})),t.append($("<h5>Background<h5>")[0]),t.append(ColorPicker(this.model.backgroundColor,function(e){o.model.backgroundColor=e.value}))},e}(Editor),Card=function(){};function ColorPicker(e,t){""==e&&(e="#FFFFFF");var n=Create("input","color-picker");return n.type="color",n.value=e,$(n).on("change",function(e){t(e.target)}),n}function DialogueCard(e,t,n){var o=e.userMessage.contentType==ContentType.Speech?ContentType.Speech:ContentType.Action;return MessageCard(e.title,e.userMessage.senderType,o,t,n)}function CreateDynamicContent(e,t,n,o,i,r){var a;return t==ContentType.Image?null!=(t=Files.GetFile(e))&&t.file.type.Contains("video")?((a=Create("video",i,r)).src=null!=t&&t.url?t.url:"assets/image.png",a.muted=!0,a.loop=!0,a.autoplay=!0,a):((a=Create("img",i,r)).src=null!=t&&t.url?t.url:"assets/image.png",a):((i=Create(n,o,r)).innerText=e.ReplaceAll("<>",""),i)}function ImageCard(e,t,n){var o=Create("div","activity-dialogue dialogue-action"),e=(CreateDynamicContent(e,ContentType.Image,"","","card-image",o),Create("button","edit-button",o));return $(e).on("click",function(){t&&t()}),n&&(e=Create("div","string-delete",o),n=new MoreMenu(n).element,e.appendChild(n)),o}function MessageCard(e,t,n,o,i){n!=ContentType.Image&&30<e.length&&(e=e.substring(0,30)+"...");t=Create("div",n!=ContentType.Speech?"activity-dialogue dialogue-action":t==SenderType.User?"activity-dialogue dialogue-speech-user":"activity-dialogue dialogue-speech-bot"),t.append(CreateDynamicContent(e,n,"span","","card-image",t)),e=Create("button","edit-button",t);return $(e).on("click",function(){o&&o()}),i&&t.appendChild(new MoreMenu(i).element),t}var MoreMenu=function(){function e(e,t){var n=this,o=(this.DomClickBound=this.DomClick.bind(this),Create("div","more-vert-div")),t=(t&&(o.style.backgroundColor="#0000003d"),this.options=Create("ul","more-vert-options-list more-vert-options-list-left",o),Create("button","more-vert",o));$(t).on("click",function(){$(n.options).slideDown(200)}),e.forEach(function(e){var t;e&&(t=Create("li","",n.options),$(t).append('<button class="more-vert-option" style="color:'.concat(e.color||"white",';">').concat(e.name,"</button>")).on("click",function(){e.function(),document.removeEventListener("click",n.DomClickBound)}))}),document.addEventListener("click",this.DomClickBound),this.element=o}return e.prototype.DomClick=function(e){!this.element||this.element.contains(e.target)||$(this.options).slideUp(200)},e}();function RadioPicker(o,e){var i=Create("div","editor-radio-div");return e.forEach(function(t){var e=Create("div","",i),n=$('<input type="radio", name="'.concat(o,'" ').concat(t.active?"checked":"",">"))[0];$(n).on("change",function(e){t.function&&t.function()}),e.appendChild(n),$(e).append("<label>".concat(t.label,"</label>"))}),i}function SearchableList(t,o,n,i,e){var r,a,s=Create("div",""),l=Create("div","flex-box",s),c="",u=(i&&((a=Create("input","editor-input",l)).type="search",a.placeholder="Search...",a.addEventListener("change",function(e){c=e.target.value,p()})),e&&l.append(new MoreMenu(e,!0).element),Create("ul","editor-ul",s));function p(){u.ClearChildren(),null!=t&&t.forEach(function(e,t){var n;i&&c&&!i(e).toLowerCase().Contains(c.toLowerCase())||(n=Create("li","",u),e=o(e,t,d),n.appendChild(e))}),n&&h()}function d(){null!=r&&r.remove();var e=n(),e=(t.push(e),o(e,t.length-1,d));u.appendChild(e),h()}function h(){r=Create("li","",u),$(r).append('<button class="add-button">+</button>').on("click",d)}return p(),s}function StringCard(e,t,n,o,i,r){var a,s=Create("div","string-edit-wrapper"),l=Create("div","string-edit",s),c=r?"textarea":"input";return r?(a=Create(c,"editor-input",l)).addEventListener("keyup",function(e){e=e.target;e.style.height="5px",e.style.height=e.scrollHeight+"px"}):a=Create(c,"editor-input",l),a.value=e,a.rows=1,setTimeout(function(){a.style.height="5px",a.style.height=a.scrollHeight+"px"},100),!i||"<>"!==e&&""!==e||setTimeout(function(){a.focus({preventScroll:!0}),a.value=""},50),$(a).on("change",function(e){t&&(e.target.value=e.target.value.ReplaceAll("\n",""),t(e.target))}),o&&(r=Create("div","string-delete",s),c=new MoreMenu(o).element,r.appendChild(c)),n&&a.addEventListener("keydown",function(e){"Enter"==e.key&&n()}),s}function TitleWithOptions(e,t){var n=Create("div","options-title-div");return Create("h3","options-title",n).innerText=e,n.append(new MoreMenu(t,!0).element),n}var __extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),DataEditor=function(t){function e(){var e=t.call(this)||this;return e.SetTitle("Data"),e.model={Activities:$.extend(!0,[],Data.Activities),botName:Data.botName,userPfp:Data.userPfp,userColor:Data.userColor,botColor:Data.botColor,actionColor:Data.actionColor,pronouns:Clone(Data.pronouns),userNicknames:Clone(Data.userNicknames),botNicknames:Clone(Data.botNicknames),nicknamesEnabled:Data.nicknamesEnabled,awayMessages:Clone(Data.awayMessages),awayThreshhold:Data.awayThreshhold},e.RefreshDisplay(),e}return __extends(e,t),e.prototype.RefreshDisplay=function(){var i=this,e=this.NewBox(),t=(this.SetChild(e),e.append($("<h3>Activities<h3>")[0]),e.append(SearchableList(this.model.Activities,function(t,e){var n=t.name==(null==(n=Activity.Current)?void 0:n.name)?ContentType.Speech:ContentType.Action,o=MessageCard(t.name,SenderType.User,n,function(){i.ApplyModifications(),EditorManager.Open(new ActivityEditor(t,i.RefreshDisplay.bind(i)))},[{name:"Set",color:"yellow",function:function(){i.ApplyModifications(),Activity.SetCurrent(t),i.Close()}},{name:"Clone",function:function(){i.model.Activities.CloneElement(e),"Default"==i.model.Activities[e+1].name&&(i.model.Activities[e+1].name="<>"),i.RefreshDisplay()}},0<e?{name:"Delete",color:"red",function:function(){i.model.Activities=i.model.Activities.filter(function(e){return e!=t}),o.remove()}}:null]);return o},function(){var e=new Activity("<>",[]);return i.model.Activities.push(e),e})),(e=this.NewBox()).append($("<h5>User Profile Picture</h5>")[0]),e.append(ImageCard(this.model.userPfp,function(){EditorManager.Open(new ImagePicker([Files.ProfilePicturesCategory],function(e){i.model.userPfp=e,i.RefreshDisplay()}))},null)),(e=this.NewBox()).append($("<h3>Colors</h3>")[0]),e.append($("<h5>User<h5>")[0]),e.append(ColorPicker(this.model.userColor,function(e){i.model.userColor=e.value})),e.append($("<h5>".concat(this.model.botName,"<h5>"))[0]),e.append(ColorPicker(this.model.botColor,function(e){i.model.botColor=e.value})),e.append($("<h5>Action Cards<h5>")[0]),e.append(ColorPicker(this.model.actionColor,function(e){i.model.actionColor=e.value})),(e=this.NewBox()).append($("<h3>Character's Name<h3>")[0]),e.append(StringCard(this.model.botName,function(e){""==e.value?(e.value="<>",i.model.botName="<>"):i.model.botName=e.value,i.RefreshDisplay()},null)),(e=this.NewBox()).append($("<h3>Away Messages<h3>")[0]),e.append($("<h5>When restarting the app after a while, define messages that are sent as you return.</h5><br/><br/>")[0]),e.append(SearchableList(this.model.awayMessages,function(n,e){var t=null==n?void 0:n.messages[0],o=Create("div"),t=MessageCard(null==t?void 0:t.strings[0],null==t?void 0:t.senderType,null==t?void 0:t.contentType,function(){i.ApplyModifications();var e,t=new ExchangeEditor(n,i.RefreshDisplay.bind(i));EditorManager.Open(t),"<>"==(null==(e=n.messages[0])?void 0:e.strings[0])&&EditorManager.Open(new MessageEditor(n.messages[0],t.RefreshDisplay.bind(t)))},MoreMenuArrayFunctions(i,i.model.awayMessages,e,o,ClipData.Exchange));return o.append(t),t},function(){return new Exchange([new Message(SenderType.Bot,ContentType.Speech,["<>"])],[],"")},function(e){return JSON.stringify(e)},[{name:"Clear",color:"red",function:function(){i.model.awayMessages=[],i.RefreshDisplay()}}])),e.append($("<h5>Number of hours threshhold</h5><br/><br/>")[0]),e.append($('<input class="editor-input-short" type="number" value="'.concat(this.model.awayThreshhold,'">')).on("change",function(e){i.model.awayThreshhold=parseFloat(e.target.value),i.model.awayThreshhold<0&&(i.model.awayThreshhold=0),e.target.value=i.model.awayThreshhold})[0]),(e=this.NewBox()).append($("<h3>Pronouns<h3>")[0]),e.append($('<h5>Use <span style="color:darkgoldenrod;">{sub}</span>, <span style="color:darkgoldenrod;">{obj}</span>, and <span style="color:darkgoldenrod;">{pos}</span> to insert into action messages. Will occasionally be replaced by '.concat(this.model.botName,"'s name to sound more natural. One per action message is generally enough.</h5><br/><br/>"))[0]),e.append($("<h5>Subjective</h5>")[0]),e.append(StringCard(this.model.pronouns.sub,function(e){i.model.pronouns.sub=e.value})),e.append($("<h5>Objective</h5>")[0]),e.append(StringCard(this.model.pronouns.obj,function(e){i.model.pronouns.obj=e.value})),e.append($("<h5>Possessive</h5>")[0]),e.append(StringCard(this.model.pronouns.pos,function(e){i.model.pronouns.pos=e.value})),(e=this.NewBox()).append($("<h3>Nicknames<h3>")[0]),e.append(RadioPicker("nicknames-enabled",[{label:"Disabled",function:function(){i.model.nicknamesEnabled=!1},active:0==this.model.nicknamesEnabled},{label:"Enabled",function:function(){i.model.nicknamesEnabled=!0},active:this.model.nicknamesEnabled}])),e.append($("<h5>For User</h5>")[0]),SearchableList(this.model.userNicknames,function(e,t,n){var o=Create("div"),e=StringCard(e,function(e){""==e.value?(e.value="<>",i.model.userNicknames[t]="<>"):i.model.userNicknames[t]=e.value},n,MoreMenuArrayFunctions(i,i.model.userNicknames,t,o,ClipData.String));return o.appendChild(e),o},function(){return"<>"})),t=(e.append(t),e.append($("<h5>For ".concat(this.model.botName,"</h5>"))[0]),SearchableList(this.model.botNicknames,function(e,t,n){var o=Create("div"),e=StringCard(e,function(e){""==e.value?(e.value="<>",i.model.botNicknames[t]="<>"):i.model.botNicknames[t]=e.value},n,MoreMenuArrayFunctions(i,i.model.botNicknames,t,o,ClipData.String));return o.append(e),o},function(){return"<>"})),n=(e.append(t),(e=this.NewBox()).append($("<h3>Data</h3>")[0]),e.append($("<h5>Chat Cleanup</h5>")[0]),e.append($('<button class="editor-button">Clear chat history</button>').on("click",function(e){i.ApplyModifications(),i.Close(),Chat.Clear(),Data.Save()})[0]),e.append($("<h5>Save</h5>")[0]),e.append($('<button class="editor-button">Copy app data to clipboard</button>').on("click",function(t){i.ApplyModifications(),Data.Save(function(){Data.GetData(function(e){navigator.clipboard.writeText(e),t.target.innerText="Copied!"})})})[0]),e.append($("<h5>Load</h5>")[0]),$('<textarea class="editor-input" rows="3" placeholder = "Paste JSON save data here...">')[0]),t=(e.append(n),$('<button class="editor-input">Load</button>').on("click",function(){Data.LoadJSON(n.value),i.Close()})[0]);e.append(t),e.append($("<h5>Delete</h5>")[0]),e.append($('<button class="editor-button">DELETE ALL DATA</button>').on("click",function(e){Data.DeleteAllData()})[0])},e.prototype.ApplyModifications=function(){Data.Activities=this.model.Activities,Data.botName=this.model.botName,Data.userPfp=this.model.userPfp,Data.userColor=this.model.userColor,Data.botColor=this.model.botColor,Data.actionColor=this.model.actionColor,Data.userNicknames=this.model.userNicknames,Data.botNicknames=this.model.botNicknames,Data.pronouns=this.model.pronouns,Data.nicknamesEnabled=this.model.nicknamesEnabled,Data.awayMessages=this.model.awayMessages,Data.awayThreshhold=this.model.awayThreshhold,Data.UpdateColors()},e}(Editor);function MoreMenuArrayFunctions(e,t,n,o,i,r){var a=[{name:"Copy",function:function(){Data.clipboard={type:i,value:Clone(t[n])},e.RefreshDisplay()}},Data.clipboard.type==i?{name:"Paste",function:function(){t[n]=Clone(Data.clipboard.value),e.RefreshDisplay()}}:null,{name:"Clone",function:function(){t.CloneElement(n),e.RefreshDisplay()}},{name:"Delete",color:"red",function:function(){t.splice(n,1),o.remove()}}];return r?r.concat(a):a}var SenderType,ContentType,__extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),DialogueEditor=function(n){function e(e,t){t=n.call(this,t)||this;return t.dialogue=e,t.model={title:e.title,userMessage:$.extend(!0,{},e.userMessage),exchanges:$.extend(!0,[],e.exchanges)},t.RefreshDisplay(),t}return __extends(e,n),e.prototype.ApplyModifications=function(){this.dialogue.title=this.model.title,this.dialogue.exchanges=this.model.exchanges,this.dialogue.userMessage=this.model.userMessage},e.prototype.RefreshDisplay=function(){var i=this,e=(this.SetTitle(this.model.title),this.NewBox());this.SetChild(e);Create("h3","",e).innerText="Title/Search Term";var t=Create("div","editor-title-div",e),t=Create("div","",t),n=Create("input","editor-input",t),t=(n.value=this.model.title,""!=this.model.title&&"<>"!=this.model.title||setTimeout(function(){n.focus(),n.value=""},50),n.addEventListener("change",function(e){i.model.title=e.target.value,""==i.model.title&&(i.model.title="<>",e.target.value="<>"),i.SetTitle(i.model.title)}),e=this.NewBox(),$(e).append("<h3>Initial Message</h3>"),Create("div","form-group row",e)),o=this.model.userMessage,t=(console.log(o.strings[0]),console.log(Files.GetFile(o.strings[0])),t.appendChild(MessageCard(o.strings[0],o.senderType,o.contentType,function(){i.ApplyModifications(),EditorManager.Open(new MessageEditor(o,i.RefreshDisplay.bind(i)))},[{name:"Copy",color:"white",function:function(){Data.clipboard={type:ClipData.Message,value:Clone(o)},i.RefreshDisplay()}},Data.clipboard.type==ClipData.Message?{name:"Paste",color:"white",function:function(){i.model.userMessage=Data.clipboard.value,i.RefreshDisplay()}}:null])),e=this.NewBox(),$(e).append("<h3>Possible Exchanges</h3>"),SearchableList(this.model.exchanges,function(n,e){var t=n.messages[0],o=Create("div"),t=(console.log(t.strings[0]),MessageCard(t.strings[0]+"...",t.senderType,t.contentType,function(){i.ApplyModifications();var e,t=new ExchangeEditor(n,i.RefreshDisplay.bind(i));EditorManager.Open(t),"<>"==(null==(e=n.messages[0])?void 0:e.strings[0])&&EditorManager.Open(new MessageEditor(n.messages[0],t.RefreshDisplay.bind(t)))},MoreMenuArrayFunctions(i,i.model.exchanges,e,o,ClipData.Exchange)));return o.append(t),o},function(){return new Exchange([new Message(0,0,["<>"])])}));e.append(t)},e}(Editor),__extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),ExchangeEditor=function(n){function e(e,t){t=n.call(this,t)||this;return t.SetTitle("Exchange"),t.exchange=e,t.model={messages:$.extend(!0,[],e.messages),dialogueChoices:$.extend(!0,[],e.dialoguePaths),switchToActivity:e.switchToActivity||""},t.RefreshDisplay(),t}return __extends(e,n),e.prototype.ApplyModifications=function(){this.exchange.messages=this.model.messages,this.exchange.dialoguePaths=this.model.dialogueChoices,this.exchange.switchToActivity=this.model.switchToActivity},e.prototype.RefreshDisplay=function(){var o=this,e=this.NewBox(),t=(this.SetChild(e),e.append($("<h2>Message Sequence</h2>")[0]),SearchableList(this.model.messages,function(e,t){var n=Create("div"),t=MessageCard(e.strings[0],e.senderType,e.contentType,function(){o.ApplyModifications(),EditorManager.Open(new MessageEditor(e,o.RefreshDisplay.bind(o)))},MoreMenuArrayFunctions(o,o.model.messages,t,n,ClipData.Message));return n.append(t),n},function(){return new Message(SenderType.User,ContentType.Speech,["<>"],[])})),t=(e.append(t),(e=this.NewBox()).append($("<h3>Switch to Activity upon Starting Exchange<h3>")[0]),e.append($('<input placeholder="Activity Name"class="editor-input" value='.concat(this.model.switchToActivity,">")).on("change",function(e){o.model.switchToActivity=e.target.value,o.RefreshDisplay()})[0]),(e=this.NewBox()).append($("<h3>Followup Dialogue Options<h3>")[0]),SearchableList(this.model.dialogueChoices,function(e,t){var n=Create("div"),t=DialogueCard(e,function(){o.ApplyModifications(),EditorManager.Open(new DialogueEditor(e,o.RefreshDisplay.bind(o)))},MoreMenuArrayFunctions(o,o.model.dialogueChoices,t,n,ClipData.Dialogue));return n.append(t),n},function(){return new Dialogue("",new Message(0,0,["<>"],[]),[])}));e.append(t)},e}(Editor),__extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),ImagePicker=function(o){function e(e,t){var n=o.call(this,null,!0)||this;return n.categories=[],n.SetTitle("Select Image"),n.onFinish=t,n.categories=e,n.RefreshDisplay(),n}return __extends(e,o),e.prototype.ApplyModifications=function(){},e.prototype.RefreshDisplay=function(){var t,e,r=this;this.SetChild($('<button class="editor-button">No Image</button>').on("click",function(){r.onFinish&&r.onFinish(""),r.Close()})[0]),this.append($("<br/>")[0]),this.append($("<br/>")[0]),this.categories.Contains(Files.BackgroundCategory)&&this.categories.Contains(Files.ProfilePicturesCategory)||((t=Create("input","editor-input-short")).placeholder="New Category Name...",(e=Create("button","editor-button")).innerText="Add Category",$(e).on("click",function(){var e=t.value;""!=e&&(Files.Categories.Contains(e)&&(e+=" (Copy)"),r.categories.push(e),r.RefreshDisplay())}),this.append(t),this.append(e)),this.categories.forEach(function(i){var n=Create("div","image-picker-container"),e=(n.style.position="relative",$('<label class="add-button">+</label>')[0]);$(e).append($('<input multiple class="image-file-picker" type="file" accept="image/*,video/*">').on("change",function(e){console.log("filessss"),console.log(e.target.files[0]);var t=e.target.files;console.log(t),console.log(t.length);for(var n=0;n<(null==t?void 0:t.length);n++){var o=t[n];Files.AddFile({file:o,category:i})}Data.Save(),r.RefreshDisplay()})[0]),n.append($("<h3>".concat(i,"</h3>"))[0]),n.append($('<div class="top-right"></div>').append(new MoreMenu([{name:"Add Media",function:function(){e.click(),r.RefreshDisplay()}},{name:"Delete",color:"red",function:function(){Files.RemoveCategory(i),r.categories=r.categories.filter(function(e){return e!=i}),r.RefreshDisplay()}}]).element)[0]),n.append($("<hr />")[0]),Files.Files.filter(function(e){return e.category==i}).forEach(function(e){var t=Create("div","picker-image-div",n),t=Create("div","",t);e.file.name.Contains(".mp4")?t.append($('<video autoplay muted loop class="picker-image" src="'.concat(e.url,'">')).on("click",function(){r.onFinish&&r.onFinish(e.file.name),r.Close()})[0]):t.append($('<img class="picker-image" src="'.concat(e.url,'">')).on("click",function(){console.log(e.file.name),r.onFinish&&r.onFinish(e.file.name),r.Close()})[0]),t.append($('<div class="top-right"></div>').append(new MoreMenu([{name:"Delete",color:"red",function:function(){Files.RemoveFile(e.file.name),r.RefreshDisplay()}}]).element)[0])}),r.append(n)})},e}(Editor),__extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}))(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),MessageEditor=function(n){function e(e,t){t=n.call(this,t)||this;return t.SetTitle("Message"),t.message=e,t.model={strings:$.extend(!0,[],e.strings),contentType:e.contentType,senderType:e.senderType,emoji:$.extend(!0,[],e.emoji)},t.RefreshDisplay(),t}return __extends(e,n),e.prototype.ApplyModifications=function(){this.model.contentType!=ContentType.Speech&&(this.model.emoji=void 0),this.model.strings=this.model.strings.filter(function(e){return""!=e}),this.message.strings=this.model.strings,this.message.senderType=this.model.senderType,this.message.contentType=this.model.contentType,this.message.emoji=this.model.emoji},e.prototype.RefreshDisplay=function(){var i=this,e=this.NewBox(),t=(this.SetChild(e),$(e).append("<h3>Sender<h3>"),RadioPicker("sender-type",[{label:"User",active:this.model.senderType==SenderType.User,function:function(){i.model.senderType=SenderType.User,i.RefreshDisplay()}},{label:Data.botName,active:this.model.senderType==SenderType.Bot,function:function(){i.model.senderType=SenderType.Bot,i.RefreshDisplay()}}])),t=(e.appendChild(t),$(e).append("<h3>Content Type<h3>"),RadioPicker("content-type",[{label:"Speech",active:this.model.contentType==ContentType.Speech,function:function(){i.model.contentType=ContentType.Speech,i.RefreshDisplay()}},{label:"Action",active:this.model.contentType==ContentType.Action,function:function(){i.model.contentType=ContentType.Action,i.RefreshDisplay()}},{label:"Image",active:this.model.contentType==ContentType.Image,function:function(){i.model.contentType=ContentType.Image,i.RefreshDisplay()}}]));e.appendChild(t),e=this.NewBox(),$(e).append("<h3>Variations<h3>"),this.model.contentType==ContentType.Action&&((t=Create("div","flex-box",e)).append($('<button class="editor-button">{sub}</button>').on("click",function(){"<>"==i.model.strings[i.model.strings.length-1]&&(i.model.strings[i.model.strings.length-1]=""),i.model.strings[i.model.strings.length-1]+="{sub} ",i.RefreshDisplay()})[0]),t.append($('<button class="editor-button">{obj}</button>').on("click",function(){"<>"==i.model.strings[i.model.strings.length-1]&&(i.model.strings[i.model.strings.length-1]=""),i.model.strings[i.model.strings.length-1]+="{obj} ",i.RefreshDisplay()})[0]),t.append($('<button class="editor-button">{pos}</button>').on("click",function(){"<>"==i.model.strings[i.model.strings.length-1]&&(i.model.strings[i.model.strings.length-1]=""),i.model.strings[i.model.strings.length-1]+="{pos} ",i.RefreshDisplay()})[0])),this.model.contentType!=ContentType.Image?(t=SearchableList(this.model.strings,function(e,t,n){var o=Create("div"),e=StringCard(e,function(e){""==e.value||"\n"==e.value?(e.value="<>",i.model.strings[t]="<>"):i.model.strings[t]=e.value},n,MoreMenuArrayFunctions(i,i.model.strings,t,o,ClipData.String),!0,!0);return o.append(e),o},function(){return"<>"}),e.appendChild(t),this.model.contentType==ContentType.Speech&&(e=this.NewBox(),$(e).append("<h3>Emoji</h3>"),e.appendChild(SearchableList(this.model.emoji,function(e,t,n){var o=Create("div"),e=StringCard(e,function(e){""==e.value?(e.value="ðŸ™‚",i.model.emoji[t]="ðŸ™‚"):i.model.emoji[t]=e.value},n,MoreMenuArrayFunctions(i,i.model.emoji,t,o,ClipData.String),!0);return o.append(e),o},function(){return""})))):(t=SearchableList(this.model.strings,function(e,t,n){var o=Create("div",""),e=ImageCard(e,function(){EditorManager.Open(new ImagePicker(Files.GetArtCategories(),function(e){i.model.strings[t]=e,i.RefreshDisplay()}))},MoreMenuArrayFunctions(i,i.model.strings,t,o,ClipData.String));return o.append(e),o},function(){return"<>"}),e.appendChild(t))},e}(Editor);function Clone(e){return"string"==typeof e?e:Array.isArray(e)?$.extend(!0,[],e):$.extend(!0,{},e)}function Create(e,t,n){e=document.createElement(e);return t&&(e.className=t),n&&n.appendChild(e),e}String.prototype.Contains=function(e){return-1!=this.lastIndexOf(e)},String.prototype.PickChar=function(){var e=this.toString();return e[Math.floor(Math.random()*(e.length-1))]},String.prototype.ReplaceAll=function(e,t){if(e==t)return e;for(var n=this;n.Contains(e);)n=n.replace(e,t);return n},String.prototype.LastChar=function(){return this[this.length-1]},String.prototype.Capitalize=function(){return this.length<2?this.toUpperCase():this[0].toUpperCase()+this.substring(1,this.length).toLowerCase()},String.prototype.Count=function(e){for(var t=0,n=0;-1<t;)-1<(t=this.indexOf(e,t))&&t++,t>=this.length&&(t=-1),n++;return n},String.prototype.ToSearchTerm=function(){for(var e=".'\"?! ,;_-=(){}[]",t=this.toLowerCase(),n=0;n<e.length;n++)t=t.ReplaceAll(e[n],"");return t},HTMLElement.prototype.ClearChildren=function(){for(;this.firstElementChild;)this.removeChild(this.firstElementChild)},Array.prototype.PickOne=function(){return this[Math.floor(Math.random()*this.length)]},Array.prototype.CloneElement=function(e){this.splice(e,0,Clone(this[e]))},Array.prototype.Contains=function(t){return this.some(function(e){return e==t})},Array.prototype.SortByLength=function(){for(var e,t=0;t<this.length-1;t++)this[t].length>this[t+1].length&&(e=this[t+1],this[t+1]=this[t],this[t]=e,t=0);return this},Array.prototype.SortByTitleLength=function(){return this.sort(function(e,t){return e.title.length-t.title.length})},function(e){e[e.User=0]="User",e[e.Bot=1]="Bot"}(SenderType=SenderType||{}),function(e){e[e.Speech=0]="Speech",e[e.Action=1]="Action",e[e.Image=2]="Image"}(ContentType=ContentType||{});var mainInput=document.getElementById("input-main");function GetStorageSize(){var e,t,n=0;for(t in localStorage)localStorage.hasOwnProperty(t)&&(n+=e=2*(localStorage[t].length+t.length),console.log(t.substr(0,50)+" = "+(e/1024).toFixed(2)+" KB"));console.log("Total = "+(n/1024).toFixed(2)+" KB")}null!=mainInput&&mainInput.addEventListener("keyup",function(t){var e,n;""==(null==(n=t.currentTarget)?void 0:n.value)?Chat.SetSuggestions([]):(n=null==(n=null==(n=Activity.Current)?void 0:n.dialogues)?void 0:n.filter(function(e){return e.title.ToSearchTerm().Contains(null==(e=null==(e=t.currentTarget)?void 0:e.value)?void 0:e.ToSearchTerm())}),(n=(null==(e=Activity.Current)?void 0:e.name)!=Data.Activities[0].name?n.concat(Data.Activities[0].dialogues.filter(function(e){return e.title.ToSearchTerm().Contains(null==(e=null==(e=t.currentTarget)?void 0:e.value)?void 0:e.ToSearchTerm())})):n)&&Chat.SetSuggestions(n.SortByTitleLength()))}),null!=mainInput&&mainInput.addEventListener("keyup",function(e){"Enter"==e.key&&(0<Chat.currentSuggestions.length?Chat.PlayDialogue(Chat.currentSuggestions[0]):Chat.previousDialogue&&0==Chat.dialogueQueue.length&&Chat.PlayDialogue(Chat.previousDialogue))}),Data.Load(),$("#chat-menu-button").on("click",function(){EditorManager.Open(new DataEditor)}),$("#image-menu-button").on("click",function(){EditorManager.Open(new ImagePicker(Files.GetArtCategories(),function(e){Chat.SendString(SenderType.User,ContentType.Image,Data.userPfp,e)}))}),GetStorageSize();